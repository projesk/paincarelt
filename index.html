<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8" />
  <title>PainCare LT â€“ Geriatrinio paciento skausmo vertinimas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f5f5f7;
      color: #222;
    }
    .app {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px 12px 40px;
    }
    h1 { font-size: 1.7rem; margin-bottom: 0.25rem; }
    h2 { font-size: 1.3rem; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    h3 { margin: 0.7rem 0 0.25rem; }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      margin-top: 16px;
    }

    .hint {
      font-size: 0.9rem;
      color: #555;
    }

    label {
      display: block;
      margin-top: 8px;
    }

    input[type="number"] {
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 4px;
      width: 120px;
    }

    .primary-btn {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.95rem;
      cursor: pointer;
      background: #4b7bec;
      color: #fff;
      margin-top: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
    }

    .secondary-btn {
      border-radius: 999px;
      border: 1px solid #4b7bec;
      padding: 6px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      background: #fff;
      color: #4b7bec;
      margin-top: 10px;
      margin-left: 4px;
    }

    .radio-row {
      display: grid;
      grid-template-columns: 40px 1.3fr 2fr 240px;
      gap: 10px;
      align-items: flex-start;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
      font-size: 0.92rem;
    }

    .radio-header {
      font-weight: 600;
      border-bottom: 2px solid #ddd;
      margin-top: 8px;
      padding-bottom: 4px;
    }

    .radio-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .radio-group label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 0;
      font-size: 0.88rem;
      cursor: pointer;
    }

    .hidden { display:none; }

    .mmse-figure-box {
      margin-top: 12px;
      padding: 10px;
      border-radius: 10px;
      background: #f1f2f6;
      display: inline-block;
    }

    .mmse-figure-box p {
      margin: 0 0 6px 0;
      font-size: 0.85rem;
      color: #444;
    }

    /* Iowa spalvos */
    .iowa-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .iowa-face {
      font-size: 2rem;
      width: 40px;
      text-align: center;
    }
    .iowa-bar {
      width: 140px;
      height: 24px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      padding-left: 6px;
      color: #000;
      font-size: 0.9rem;
    }
    .iowa-0 { background: #d4f8d4; }
    .iowa-1 { background: #e6f9c7; }
    .iowa-2 { background: #fdf3c4; }
    .iowa-3 { background: #ffe0b5; }
    .iowa-4 { background: #ffc9c9; }
    .iowa-5 { background: #ffb3b3; }
    .iowa-6 { background: #ff9e9e; }

    /* FPS-R veidukai */
    .faces-option {
      font-size: 1.5rem;
      padding: 6px 10px;
      border-radius: 10px;
      background: #f1f2f6;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .faces-option span.desc {
      font-size: 0.85rem;
    }

    /* DVPRS spalvos */
    .dvprs-mild   { background: #e3f9e5; }
    .dvprs-moderate { background: #fff9e3; }
    .dvprs-severe { background: #ffe5e5; }

    .dvprs-horizontal {
      display: flex;
      flex-direction: row;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    .dvprs-item {
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 0.85rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 170px;
    }
    .dvprs-face {
      font-size: 2rem;
      margin-bottom: 4px;
    }

    @media (max-width: 800px) {
      .radio-row {
        grid-template-columns: 30px 1fr;
        grid-template-rows: auto auto auto;
      }
      .radio-header { display: none; }
    }
  </style>
</head>

<body>
<div class="app">

  <!-- ================= PRADINIS EKRANAS ================= -->

  <div id="screen-start">
    <div class="card">
      <h1>PainCare LT</h1>
      <p class="hint">
        1 Å¾ingsnis â€“ pasirinkite, kas pildo Ä¯vertinimÄ…<br>
        2 Å¾ingsnis â€“ Ä¯veskite MMSE balus (jei Å¾inomi)<br>
        3 Å¾ingsnis â€“ sistema parinks skausmo skalÄ™ ir pateiks rekomendacijas
      </p>

      <h2>Kas pildo Ä¯vertinimÄ…?</h2>
      <div class="radio-group">
        <label>
          <input type="radio" name="role" value="relative" onclick="setRole('relative')">
          Artimasis
        </label>
        <label>
          <input type="radio" name="role" value="hcp" onclick="setRole('hcp')">
          Sveikatos prieÅ¾iÅ«ros specialistas
        </label>
      </div>

      <!-- MMSE Ä¯vedimas â€“ iÅ¡ pradÅ¾iÅ³ paslÄ—ptas -->
      <div id="mmse-input-section" class="hidden">
        <hr>
        <h2>1. Ä®veskite MMSE balus</h2>
        <label>
          MMSE balai (0â€“30):
          <input type="number" id="start-mmse" min="0" max="30" step="1">
        </label>

        <button class="primary-btn" onclick="handleStartWithMmse()">TÄ™sti</button>

        <!-- matomas tik HCP -->
        <button id="btn-mmse-test" class="secondary-btn" style="display:none;"
                onclick="goToMmseForm()">
          NeÅ¾inau â€“ atlikti MMSE testÄ…
        </button>
      </div>
    </div>
  </div>

  <!-- ================= MMSE EKRANAS ================= -->

  <div id="screen-mmse" class="hidden">
    <div class="card">
      <h2>MMSE â€“ Mini psichikos bÅ«klÄ—s Ä¯vertinimas</h2>

      <p class="hint">
        MMSE Ä¯vertina orientacijÄ…, dÄ—mesÄ¯, atmintÄ¯, kalbÄ… ir konstrukcinius gebÄ—jimus.<br><br>
        â€¢ 24â€“30 â€“ kognityviniÅ³ sutrikimÅ³ nÄ—ra / minimalÅ«s<br>
        â€¢ 18â€“23 â€“ lengvi sutrikimai<br>
        â€¢ 0â€“17 â€“ ryÅ¡kÅ«s sutrikimai
      </p>

      <div class="radio-row radio-header">
        <div>#</div>
        <div>Punktas</div>
        <div>Instrukcija</div>
        <div>Ä®vertinimas</div>
      </div>

      <div id="mmse-form-items"></div>

      <div class="mmse-figure-box">
        <p>PavyzdinÄ— figÅ«ra, kuriÄ… pacientas turi nukopijuoti:</p>
        <svg width="180" height="120" viewBox="0 0 180 120">
          <polygon points="60,15 25,50 38,95 82,95 95,50"
                   fill="none" stroke="#333" stroke-width="2"/>
          <polygon points="110,25 75,60 88,105 132,105 145,60"
                   fill="none" stroke="#333" stroke-width="2"/>
        </svg>
      </div>

      <button class="primary-btn" onclick="calculateMmseFromForm(true)">
        ApskaiÄiuoti MMSE ir tÄ™sti
      </button>

      <button class="secondary-btn" onclick="showScreen('screen-start')">
        GrÄ¯Å¾ti
      </button>

      <div id="mmse-form-result" style="display:none; margin-top:10px; border-left:4px solid #4b7bec; padding-left:12px;">
        <p id="mmse-form-main"></p>
      </div>

      <p class="hint" style="margin-top:10px;">
        Nuoroda Ä¯ lietuviÅ¡kÄ… MMSE PDF:<br>
        <a href="http://www.loravita.lt/formos/MMSE.pdf" target="_blank">
          MMSE (lietuviÅ¡ka forma, PDF)
        </a>
      </p>
    </div>
  </div>

  <!-- ================= SKALÄ–S EKRANAS ================= -->

  <div id="screen-scales" class="hidden">

    <div class="card">
      <h2>2. Skausmo skalÄ—s parinkimas</h2>
      <p id="scale-intro" class="hint"></p>
    </div>

    <!-- 18â€“23 -->
    <div id="branch-18-23" class="card hidden">
      <h3>Lengvi kognityviniai sutrikimai (MMSE 18â€“23)</h3>
      <p class="hint">Ar pacientas geba suprasti paprastÄ… vizualinÄ™ ir Å¾odinÄ™ informacijÄ…?</p>
      <button class="primary-btn" onclick="branch1823('yes')">
        Taip â€“ vizualinÄ—s / Å¾odinÄ—s skalÄ—s (Iowa, VDS, veidukai, NRS)
      </button>
      <button class="secondary-btn" onclick="branch1823('no')">
        Ne â€“ PAINAD skalÄ—
      </button>
    </div>

    <!-- 0â€“17 -->
    <div id="branch-0-17" class="card hidden">
      <h3>SunkÅ«s sutrikimai (MMSE 0â€“17)</h3>
      <p class="hint">Pasirinkite pagal situacijÄ…:</p>
      <button class="primary-btn" onclick="branch017Quick()">Greitas Ä¯vertinimas â€“ Abbey</button>
      <button class="secondary-btn" onclick="branch017Detailed()">IÅ¡samus â€“ PAIC-15</button>
    </div>

    <div id="branch-0-17-paic" class="card hidden">
      <h3>IÅ¡samus vertinimas</h3>
      <p class="hint">Ar mokate naudoti PAIC-15?</p>
      <button class="primary-btn" onclick="branch017Paic('yes')">Taip â€“ PAIC-15</button>
      <button class="secondary-btn" onclick="branch017Paic('no')">Ne â€“ Abbey</button>
      <p class="hint">
        PAIC-15 mokymai:
        <a href="https://paic15.org/en/1" target="_blank">https://paic15.org/en/1</a>
      </p>
    </div>

    <!-- PAPRASTOS SKALÄ–S -->

    <div id="card-simple" class="card hidden">
      <h2>Iowa, Å¾odinÄ— skalÄ—, veidukai, NRS</h2>

      <h3>Iowa Pain Thermometer</h3>
      <p class="hint">Spalvos: Å¾alia â†’ raudona (nuo â€neskaudaâ€œ iki â€labai skaudaâ€œ).</p>

      <div class="radio-group" style="flex-direction: column; gap:6px;">
        <label class="iowa-row">
          <span class="iowa-face">ğŸ™‚</span>
          <input type="radio" name="iowa-thermo" value="0">
          <div class="iowa-bar iowa-0">0 â€“ NÄ—ra skausmo</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜Š</span>
          <input type="radio" name="iowa-thermo" value="1">
          <div class="iowa-bar iowa-1">1 â€“ Vos juntamas</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜</span>
          <input type="radio" name="iowa-thermo" value="2">
          <div class="iowa-bar iowa-2">2 â€“ Lengvas</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜•</span>
          <input type="radio" name="iowa-thermo" value="3">
          <div class="iowa-bar iowa-3">3 â€“ Vidutinis</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜£</span>
          <input type="radio" name="iowa-thermo" value="4">
          <div class="iowa-bar iowa-4">4 â€“ Stiprus</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜«</span>
          <input type="radio" name="iowa-thermo" value="5">
          <div class="iowa-bar iowa-5">5 â€“ Labai stiprus</div>
        </label>
        <label class="iowa-row">
          <span class="iowa-face">ğŸ˜­</span>
          <input type="radio" name="iowa-thermo" value="6">
          <div class="iowa-bar iowa-6">6 â€“ Smarkiausias Ä¯manomas skausmas</div>
        </label>
      </div>

      <hr>

      <h3>Å½odinÄ— skausmo skalÄ— (VDS)</h3>
      <div class="radio-group">
        <label><input type="radio" name="vds" value="0">0 â€“ nÄ—ra</label>
        <label><input type="radio" name="vds" value="1">1 â€“ lengvas</label>
        <label><input type="radio" name="vds" value="2">2 â€“ vidutinis</label>
        <label><input type="radio" name="vds" value="3">3 â€“ stiprus</label>
      </div>

      <hr>

      <h3>VeidukÅ³ skalÄ— (FPS-R)</h3>
      <p class="hint">PapraÅ¡ykite paciento pasirinkti veidukÄ….</p>
      <div class="radio-group">
        <label class="faces-option">
          <input type="radio" name="faces" value="0">
          <span>ğŸ™‚</span><span class="desc">NÄ—ra skausmo</span>
        </label>
        <label class="faces-option">
          <input type="radio" name="faces" value="2">
          <span>ğŸ˜Š</span><span class="desc">Labai lengvas</span>
        </label>
        <label class="faces-option">
          <input type="radio" name="faces" value="4">
          <span>ğŸ˜</span><span class="desc">Lengvas</span>
        </label>
        <label class="faces-option">
          <input type="radio" name="faces" value="6">
          <span>ğŸ˜•</span><span class="desc">Vidutinis</span>
        </label>
        <label class="faces-option">
          <input type="radio" name="faces" value="8">
          <span>ğŸ˜£</span><span class="desc">Stiprus</span>
        </label>
        <label class="faces-option">
          <input type="radio" name="faces" value="10">
          <span>ğŸ˜­</span><span class="desc">Labai stiprus</span>
        </label>
      </div>

      <hr>

      <h3>NRS (0â€“10)</h3>
      <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
        <input type="range" id="nrs-slider" min="0" max="10" value="0"
               oninput="document.getElementById('nrs-value').textContent=this.value">
        <span><strong>NRS:</strong> <span id="nrs-value">0</span>/10</span>
      </div>

      <button class="primary-btn" onclick="summarizeSimpleScales()">
        ApskaiÄiuoti
      </button>

    <div id="simple-scales-result" style="display:none;">
  <p id="simple-scales-main"></p>
  <p id="simple-scales-summary"><!-- apibendrintas --></p>
  <p id="simple-scales-interpretation" class="hint"></p>
  <p id="simple-scales-warning" class="hint" style="color:#b00020;"></p>
  <div id="simple-scales-next" class="hidden" style="margin-top:6px;">
  <button class="secondary-btn" onclick="goFromSimpleToPainad()">
    Pereiti Ä¯ PAINAD skalÄ™
  </button>
</div>


    <!-- DVPRS -->

    <div id="card-dvprs" class="card hidden">
      <h2>DVPRS (0â€“10)</h2>
      <p class="hint">Pasirinkite skaiÄiÅ³, veidukÄ… ir apraÅ¡ymÄ…, labiausiai atitinkantÄ¯ skausmÄ….</p>
      <div id="dvprs-options" class="dvprs-horizontal"></div>
      <button class="primary-btn" onclick="calculateDvprs()">SkaiÄiuoti</button>
      <div id="dvprs-result-box" style="display:none;">
        <p id="dvprs-result-main"></p>
        <p id="dvprs-result-interpretation" class="hint"></p>
      </div>
    </div>

    <!-- PAINAD -->

    <div id="card-painad" class="card hidden">
      <h2>PAINAD (0â€“10)</h2>
      <p class="hint">Vertinama stebint pacientÄ… ~5 minutes.</p>
      <div class="radio-row radio-header">
        <div>#</div><div>Kategorija</div><div>PavyzdÅ¾iai</div><div>Balai</div>
      </div>
      <div id="painad-items"></div>
      <button class="primary-btn" onclick="calculatePainad()">SkaiÄiuoti PAINAD</button>
      <div id="painad-result-box" style="display:none;">
        <p id="painad-result-main"></p>
        <p id="painad-result-interpretation" class="hint"></p>
      </div>
    </div>

    <!-- PAIC-15 -->

    <div id="card-paic" class="card hidden">
      <h2>PAIC-15</h2>
      <p class="hint">0 â€“ nÄ—ra, 1 â€“ Å¡iek tiek, 2 â€“ vidutiniÅ¡kai, 3 â€“ ryÅ¡kiai, X â€“ nevertinta</p>
      <div class="radio-row radio-header">
        <div>#</div><div>PoÅ¾ymis</div><div>PaaiÅ¡kinimas</div><div>Balai</div>
      </div>
      <div id="paic-items"></div>
      <button class="primary-btn" onclick="calculatePaic()">SkaiÄiuoti PAIC</button>
      <div id="paic-result-box" style="display:none;">
        <p id="paic-result-main"></p>
        <p id="paic-result-interpretation" class="hint"></p>
      </div>
    </div>

    <!-- ABBEY -->

    <div id="card-abbey" class="card hidden">
      <h2>Abbey skausmo skalÄ—</h2>
      <p class="hint">0 â€“ nÄ—ra, 1 â€“ lengvas, 2 â€“ vidutinis, 3 â€“ ryÅ¡kus.</p>
      <div class="radio-row radio-header">
        <div>#</div><div>PoÅ¾ymis</div><div>PavyzdÅ¾iai</div><div>Balai</div>
      </div>
      <div id="abbey-items"></div>
      <h3>Skausmo tipas</h3>
      <div class="radio-group">
        <label><input type="radio" name="abbey-type" value="Chronic">LÄ—tinis</label>
        <label><input type="radio" name="abbey-type" value="Acute">Åªminis</label>
        <label><input type="radio" name="abbey-type" value="Acute on chronic">Åªminis lÄ—tinio fone</label>
      </div>
      <button class="primary-btn" onclick="calculateAbbey()">SkaiÄiuoti Abbey</button>
      <div id="abbey-result-box" style="display:none;">
        <p id="abbey-result-main"></p>
        <p id="abbey-result-interpretation" class="hint"></p>
      </div>
    </div>

    <!-- REKOMENDACIJOS -->

    <div id="recommend-card" class="card hidden">
      <h2>3. Rekomendacijos pagal skausmÄ…</h2>
      <p id="recommend-main"></p>
      <p id="recommend-extra" class="hint"></p>
    </div>

    <div class="card">
      <button class="primary-btn" onclick="resetApp()">Naujas pacientas</button>
    </div>
  </div>
</div>

<script>
  let currentMmseScore = null;
  let userRole = null; // 'relative' arba 'hcp'

  function setRole(role) {
    userRole = role;
    const mmseSection = document.getElementById('mmse-input-section');
    const mmseBtn = document.getElementById('btn-mmse-test');

    if (mmseSection) mmseSection.classList.remove('hidden');
    if (mmseBtn) {
      if (role === 'hcp') mmseBtn.style.display = 'inline-block';
      else mmseBtn.style.display = 'none';
    }
  }

  function showScreen(id) {
    ['screen-start','screen-mmse','screen-scales'].forEach(s => {
      const el = document.getElementById(s);
      if (!el) return;
      el.classList.toggle('hidden', s !== id);
    });
  }

  function handleStartWithMmse() {
    if (!userRole) {
      alert('Pasirinkite, kas pildo Ä¯vertinimÄ…: artimasis ar sveikatos prieÅ¾iÅ«ros specialistas.');
      return;
    }
    const val = Number(document.getElementById('start-mmse').value);
    if (isNaN(val) || val < 0 || val > 30) {
      alert('Ä®veskite MMSE balus nuo 0 iki 30.');
      return;
    }
    currentMmseScore = val;
    routeByMmse(val);
  }

  function goToMmseForm() {
    showScreen('screen-mmse');
  }

  /* ===== MMSE formos generavimas ir skaiÄiavimas ===== */
  const mmseFormItems = [
    { id: 'year', idx: 1,  section: 'Orientacija laike',
      title: 'Metai', meaning: 'Teisingai pasako, kokie dabar metai.' },
    { id: 'season', idx: 2, section: 'Orientacija laike',
      title: 'MetÅ³ laikas', meaning: 'Pavasaris / vasara / ruduo / Å¾iema.' },
    { id: 'month', idx: 3, section: 'Orientacija laike',
      title: 'MÄ—nuo', meaning: 'Teisingai Ä¯vardija mÄ—nesÄ¯.' },
    { id: 'day-month', idx: 4, section: 'Orientacija laike',
      title: 'MÄ—nesio diena', meaning: 'Teisingai pasako datÄ….' },
    { id: 'weekday', idx: 5, section: 'Orientacija laike',
      title: 'SavaitÄ—s diena', meaning: 'Teisingai Ä¯vardija savaitÄ—s dienÄ….' },

    { id: 'country', idx: 6, section: 'Orientacija vietoje',
      title: 'Å alis', meaning: 'Teisingai pasako, kokioje Å¡alyje yra.' },
    { id: 'region', idx: 7, section: 'Orientacija vietoje',
      title: 'Apskritis / regionas', meaning: 'Teisingai nurodo regionÄ… / apskritÄ¯.' },
    { id: 'city', idx: 8, section: 'Orientacija vietoje',
      title: 'Miestas / miestelis', meaning: 'Teisingai pasako miestÄ….' },
    { id: 'institution', idx: 9, section: 'Orientacija vietoje',
      title: 'Ä®staiga', meaning: 'LigoninÄ—, slaugos namai ir pan.' },
    { id: 'ward', idx: 10, section: 'Orientacija vietoje',
      title: 'Skyrius / palata', meaning: 'Teisingai nurodo skyriÅ³ / palatÄ… / aukÅ¡tÄ….' },

    { id: 'reg1', idx: 11, section: 'Ä®siminimas (3 Å¾odÅ¾iai)',
      title: 'Å½odis 1', meaning: 'Pvz., â€stalasâ€œ â€“ iÅ¡ karto pakartoja teisingai.' },
    { id: 'reg2', idx: 12, section: 'Ä®siminimas (3 Å¾odÅ¾iai)',
      title: 'Å½odis 2', meaning: 'Pvz., â€namasâ€œ â€“ iÅ¡ karto pakartoja teisingai.' },
    { id: 'reg3', idx: 13, section: 'Ä®siminimas (3 Å¾odÅ¾iai)',
      title: 'Å½odis 3', meaning: 'Pvz., â€gÄ—lÄ—â€œ â€“ iÅ¡ karto pakartoja teisingai.' },

    { id: 'calc1', idx: 14, section: 'DÄ—mesys ir skaiÄiavimas',
      title: '100â€“7', meaning: 'ApskaiÄiuoja 93.' },
    { id: 'calc2', idx: 15, section: 'DÄ—mesys ir skaiÄiavimas',
      title: '93â€“7', meaning: 'ApskaiÄiuoja 86.' },
    { id: 'calc3', idx: 16, section: 'DÄ—mesys ir skaiÄiavimas',
      title: '86â€“7', meaning: 'ApskaiÄiuoja 79.' },
    { id: 'calc4', idx: 17, section: 'DÄ—mesys ir skaiÄiavimas',
      title: '79â€“7', meaning: 'ApskaiÄiuoja 72.' },
    { id: 'calc5', idx: 18, section: 'DÄ—mesys ir skaiÄiavimas',
      title: '72â€“7', meaning: 'ApskaiÄiuoja 65.' },

    { id: 'rec1', idx: 19, section: 'Atsiminimas',
      title: 'Prisimena Å¾odÄ¯ 1', meaning: 'Po keliÅ³ minuÄiÅ³ prisimena pirmÄ… Å¾odÄ¯.' },
    { id: 'rec2', idx: 20, section: 'Atsiminimas',
      title: 'Prisimena Å¾odÄ¯ 2', meaning: 'Po keliÅ³ minuÄiÅ³ prisimena antrÄ… Å¾odÄ¯.' },
    { id: 'rec3', idx: 21, section: 'Atsiminimas',
      title: 'Prisimena Å¾odÄ¯ 3', meaning: 'Po keliÅ³ minuÄiÅ³ prisimena treÄiÄ… Å¾odÄ¯.' },

    { id: 'name-watch', idx: 22, section: 'Kalba â€“ Ä¯vardijimas',
      title: 'Pavadina laikrodÄ¯', meaning: 'ParodÅ¾ius laikrodÄ¯, teisingai Ä¯vardija daiktÄ….' },
    { id: 'name-pencil', idx: 23, section: 'Kalba â€“ Ä¯vardijimas',
      title: 'Pavadina pieÅ¡tukÄ…', meaning: 'ParodÅ¾ius pieÅ¡tukÄ…, teisingai Ä¯vardija daiktÄ….' },

    { id: 'repeat-phrase', idx: 24, section: 'Kalba â€“ kartojimas',
      title: 'Pakartoja sakinÄ¯', meaning: 'Teisingai pakartoja pateiktÄ… sakinÄ¯.' },

    { id: 'command1', idx: 25, section: 'Kalba â€“ vykdymas',
      title: 'Paimti lapÄ…', meaning: 'Atlieka 1-Ä… komandÄ….' },
    { id: 'command2', idx: 26, section: 'Kalba â€“ vykdymas',
      title: 'Sulankstyti per pusÄ™', meaning: 'Atlieka 2-Ä… komandÄ….' },
    { id: 'command3', idx: 27, section: 'Kalba â€“ vykdymas',
      title: 'PadÄ—ti ant grindÅ³', meaning: 'Atlieka 3-iÄ… komandÄ….' },

    { id: 'read-close-eyes', idx: 28, section: 'Skaitymas',
      title: 'Perskaito ir Ä¯vykdo â€UÅ½DARYKITE AKISâ€œ',
      meaning: 'Perskaito frazÄ™ ir trumpam uÅ¾merkia akis.' },

    { id: 'write-sentence', idx: 29, section: 'RaÅ¡ymas',
      title: 'ParaÅ¡o sakinÄ¯', meaning: 'ParaÅ¡o prasmingÄ… sakinÄ¯.' },

    { id: 'copy-figure', idx: 30, section: 'Kopijavimas',
      title: 'Nukopijuoja figÅ«rÄ…',
      meaning: 'Nukopijuoja pavyzdinÄ™ figÅ«rÄ… (2 persidengiantys penkiakampiai).' }
  ];

  const mmseFormContainer = document.getElementById('mmse-form-items');
  let currentMmseSection = '';
  mmseFormItems.forEach(item => {
    if (item.section !== currentMmseSection) {
      currentMmseSection = item.section;
      const secTitle = document.createElement('h3');
      secTitle.textContent = currentMmseSection;
      secTitle.style.marginTop = '14px';
      secTitle.style.marginBottom = '4px';
      secTitle.style.fontSize = '1rem';
      secTitle.style.color = '#333';
      mmseFormContainer.appendChild(secTitle);
    }
    const row = document.createElement('div');
    row.className = 'radio-row';
    row.innerHTML = `
      <div>${item.idx}</div>
      <div><strong>${item.title}</strong></div>
      <div>${item.meaning}</div>
      <div class="radio-group">
        <label><input type="radio" name="mmse-${item.id}" value="1">Teisingai (1 balas)</label>
        <label><input type="radio" name="mmse-${item.id}" value="0">Neteisingai / neatliko (0 balÅ³)</label>
      </div>
    `;
    mmseFormContainer.appendChild(row);
  });

  function calculateMmseFromForm(continueToScales) {
    let total = 0;
    mmseFormItems.forEach(item => {
      const selected = document.querySelector(`input[name="mmse-${item.id}"]:checked`);
      if (!selected) return;
      total += Number(selected.value);
    });
    currentMmseScore = total;
    document.getElementById('mmse-form-main').innerHTML =
      `<strong>MMSE suma: ${total} balai.</strong>`;
    document.getElementById('mmse-form-result').style.display = 'block';
    if (continueToScales) routeByMmse(total);
  }

  /* ===== Routing pagal MMSE ===== */
  function routeByMmse(score) {
    const intro = document.getElementById('scale-intro');
    ['card-simple','card-dvprs','card-painad','card-paic','card-abbey',
     'recommend-card','branch-18-23','branch-0-17','branch-0-17-paic']
      .forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
      });

    if (score >= 24) {
      intro.textContent = `MMSE ${score} â€“ kognityviniÅ³ sutrikimÅ³ nÄ—ra. Rekomenduojama DVPRS skalÄ—.`;
      document.getElementById('card-dvprs').classList.remove('hidden');
    } else if (score >= 18) {
      intro.textContent = `MMSE ${score} â€“ lengvi sutrikimai. Ä®vertinkite, ar pacientas supranta vizualinÄ™/Å¾odinÄ™ informacijÄ….`;
      document.getElementById('branch-18-23').classList.remove('hidden');
    } else {
      intro.textContent = `MMSE ${score} â€“ sunkÅ«s sutrikimai. Rekomenduojama Abbey arba PAIC-15 skalÄ—.`;
      document.getElementById('branch-0-17').classList.remove('hidden');
    }
    showScreen('screen-scales');
  }

  function branch1823(option) {
    document.getElementById('card-simple').classList.add('hidden');
    document.getElementById('card-painad').classList.add('hidden');
    if (option === 'yes') document.getElementById('card-simple').classList.remove('hidden');
    else document.getElementById('card-painad').classList.remove('hidden');
  }

  function branch017Quick() {
    document.getElementById('branch-0-17-paic').classList.add('hidden');
    document.getElementById('card-paic').classList.add('hidden');
    document.getElementById('card-abbey').classList.remove('hidden');
  }
  function branch017Detailed() {
    document.getElementById('branch-0-17-paic').classList.remove('hidden');
  }
  function branch017Paic(option) {
    document.getElementById('card-paic').classList.add('hidden');
    document.getElementById('card-abbey').classList.add('hidden');
    if (option === 'yes') document.getElementById('card-paic').classList.remove('hidden');
    else document.getElementById('card-abbey').classList.remove('hidden');
  }

  /* ===== Paprastos skalÄ—s (Iowa/VDS/FPS/NRS) ===== */
  function summarizeSimpleScales() {
  const iowaSel  = document.querySelector('input[name="iowa-thermo"]:checked');
  const vdsSel   = document.querySelector('input[name="vds"]:checked');
  const facesSel = document.querySelector('input[name="faces"]:checked');
  const nrsVal   = Number(document.getElementById('nrs-slider').value);

  // 1) Parodome, kÄ… pasirinko kiekvienoje skalÄ—je (tekstu)
  document.getElementById('simple-scales-main').innerHTML = `
    <strong>Iowa:</strong> ${(iowaSel ? iowaSel.parentElement.textContent.trim() : 'â€“')}<br>
    <strong>VDS:</strong> ${(vdsSel ? vdsSel.parentElement.textContent.trim() : 'â€“')}<br>
    <strong>Veidukai (FPS-R):</strong> ${(facesSel ? facesSel.value : 'â€“')}<br>
    <strong>NRS:</strong> ${nrsVal}/10
  `;

  // 2) Paverskime viskÄ… Ä¯ 0â€“10 skalÄ™ ir suskaiÄiuokime apibendrintÄ… intensyvumÄ…
  const numericValues = [];

  if (iowaSel) {
    // Iowa 0â€“6 â†’ paverÄiam Ä¯ 0â€“10
    const iowaNum = Number(iowaSel.value) * (10 / 6);
    numericValues.push(iowaNum);
  }

  if (vdsSel) {
    // VDS 0â€“3 â†’ paverÄiam Ä¯ 0â€“10
    const vdsNum = Number(vdsSel.value) * (10 / 3);
    numericValues.push(vdsNum);
  }

  if (facesSel) {
    // FPS-R jau duoda 0,2,4,6,8,10
    numericValues.push(Number(facesSel.value));
  }

  // NRS visada pasiimame (pagrindinÄ— pacientÅ³ skaitinÄ— skalÄ—)
  numericValues.push(nrsVal);

  // jei dÄ—l kaÅ¾ko tuÅ¡Äia (neturÄ—tÅ³ taip bÅ«ti) â€“ saugiklis
  if (!numericValues.length) {
    alert('Pasirinkite bent vienÄ… skalÄ™ prieÅ¡ skaiÄiuodami.');
    return;
  }

  const minVal = Math.min(...numericValues);
  const maxVal = Math.max(...numericValues);

  // Apibendrintas intensyvumas â€“ imame aukÅ¡ÄiausiÄ… reikÅ¡mÄ™ (saugumo sumetimais)
  const combinedScore = Math.round(maxVal);

  let levelKey = 'none';
  if (combinedScore >= 7)       levelKey = 'severe';
  else if (combinedScore >= 4)  levelKey = 'moderate';
  else if (combinedScore >= 1)  levelKey = 'mild';

  // Tekstas apie apibendrintÄ… intensyvumÄ…
  document.getElementById('simple-scales-summary').textContent =
    `Apibendrintas skausmo intensyvumas (0â€“10, pagal visas skales): apie ${combinedScore}/10.`;

  // Papildomas paaiÅ¡kinimas
  document.getElementById('simple-scales-interpretation').textContent =
    'Skirtingos skalÄ—s padeda patikrinti, ar Ä¯vertinimas nuoseklus. Apibendrintam lygiui imtame didÅ¾iausiÄ… iÅ¡ gautÅ³ balÅ³.';

  // 3) Ä®SPÄ–JIMAS, jei skalÄ—s labai skiriasi tarpusavyje
  const warningEl = document.getElementById('simple-scales-warning');
  const nextEl = document.getElementById('simple-scales-next');
  warningEl.textContent = '';
  nextEl.classList.add('hidden');

if (maxVal - minVal >= 4) {
  warningEl.textContent =
    `Ä®SPÄ–JIMAS: skirtingÅ³ skaliÅ³ rezultatai labai skiriasi (nuo ${minVal.toFixed(1)} iki ${maxVal.toFixed(1)} balÅ³ 0â€“10 skalÄ—je). ` +
    'Rekomenduojama pakartotinai Ä¯vertinti skausmÄ… ir apsvarstyti PAINAD skalÄ™.';
  nextEl.classList.remove('hidden');
}
    function goFromSimpleToPainad() {
  const painadCard = document.getElementById('card-painad');
  if (painadCard) {
    painadCard.classList.remove('hidden');
    painadCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}
  }

  // parodyti blokÄ…
  document.getElementById('simple-scales-result').style.display = 'block';

  // 4) Rekomendacijos (pagal apibendrintÄ… lygÄ¯)
  showRecommendations(levelKey);
}
  }

  /* ===== DVPRS ===== */
  const dvprsItems = [
    {score:0, text:'NÄ—ra skausmo'},
    {score:1, text:'Vos jauÄiamas skausmas'},
    {score:2, text:'Labai lengvas skausmas'},
    {score:3, text:'Lengvas skausmas'},
    {score:4, text:'Vidutinis skausmas'},
    {score:5, text:'Vidutinis, trukdantis skausmas'},
    {score:6, text:'Skausmas riboja veiklÄ…'},
    {score:7, text:'Stiprus skausmas'},
    {score:8, text:'Labai stiprus skausmas'},
    {score:9, text:'Beveik nepakeliamas skausmas'},
    {score:10,text:'Blogiausias Ä¯sivaizduojamas skausmas'}
  ];
  const dvprsFaces = ['ğŸ™‚','ğŸ™‚','ğŸ™‚','ğŸ™‚','ğŸ˜','ğŸ˜','ğŸ˜•','ğŸ˜£','ğŸ˜«','ğŸ˜­','ğŸ˜­'];
  const dvprsContainer = document.getElementById('dvprs-options');
  dvprsItems.forEach(item => {
    const div = document.createElement('div');
    let c = item.score <= 3 ? 'dvprs-mild' : item.score <= 6 ? 'dvprs-moderate' : 'dvprs-severe';
    div.className = `dvprs-item ${c}`;
    div.innerHTML = `
      <span class="dvprs-face">${dvprsFaces[item.score]}</span>
      <input type="radio" name="dvprs-score" value="${item.score}">
      <span><strong>${item.score}</strong><br>${item.text}</span>
    `;
    dvprsContainer.appendChild(div);
  });
  function calculateDvprs() {
    const sel = document.querySelector('input[name="dvprs-score"]:checked');
    if (!sel) { alert('Pasirinkite DVPRS balÄ….'); return; }
    const val = Number(sel.value);
    let levelKey = 'none';
    if (val >= 7) levelKey = 'severe';
    else if (val >= 4) levelKey = 'moderate';
    else if (val >= 1) levelKey = 'mild';
    document.getElementById('dvprs-result-main').innerHTML =
      `<strong>DVPRS:</strong> ${val} â€“ ${dvprsItems[val].text}`;
    document.getElementById('dvprs-result-interpretation').textContent =
      'Pagal Å¡Ä¯ balÄ… parenkamas skausmo malÅ¡inimo intensyvumas.';
    document.getElementById('dvprs-result-box').style.display = 'block';
    showRecommendations(levelKey);
  }

  /* ===== PAINAD ===== */
  const painadItems = [
    {
      id:'breathing', idx:1, title:'KvÄ—pavimas',
      m0:'0 â€“ normalus', m1:'1 â€“ retkarÄiais apsunkintas', m2:'2 â€“ ryÅ¡kiai apsunkintas'
    },
    {
      id:'negative-vocal', idx:2, title:'Neigiama vokalizacija',
      m0:'0 â€“ nÄ—ra', m1:'1 â€“ dejuoja, pÅ«kÅ¡Äia, kalba Å¾emu tonu, negatyviai',
      m2:'2 â€“ Å¡aukia, verkia'
    },
    {
      id:'facial-exp', idx:3, title:'Veido iÅ¡raiÅ¡ka',
      m0:'0 â€“ neutrali / Å¡ypsosi', m1:'1 â€“ liÅ«dna, susiraukusi', m2:'2 â€“ aiÅ¡ki grimasa'
    },
    {
      id:'body-language', idx:4, title:'KÅ«no kalba',
      m0:'0 â€“ atsipalaidavÄ™s', m1:'1 â€“ Ä¯temptas, nerimastingas',
      m2:'2 â€“ sustingÄ™s, ginasi'
    },
    {
      id:'consolability', idx:5, title:'Raminamumas',
      m0:'0 â€“ nereikia raminti', m1:'1 â€“ nusiramina balsu ar prisilietimu',
      m2:'2 â€“ nepavyksta nuraminti'
    }
  ];
  const painadContainer = document.getElementById('painad-items');
  painadItems.forEach(item => {
    const row = document.createElement('div');
    row.className = 'radio-row';
    row.innerHTML = `
      <div>${item.idx}</div>
      <div><strong>${item.title}</strong></div>
      <div>${item.m0}<br>${item.m1}<br>${item.m2}</div>
      <div class="radio-group">
        <label><input type="radio" name="painad-${item.id}" value="0">0</label>
        <label><input type="radio" name="painad-${item.id}" value="1">1</label>
        <label><input type="radio" name="painad-${item.id}" value="2">2</label>
      </div>
    `;
    painadContainer.appendChild(row);
  });
  function calculatePainad() {
    let total = 0;
    painadItems.forEach(item => {
      const sel = document.querySelector(`input[name="painad-${item.id}"]:checked`);
      if (sel) total += Number(sel.value);
    });
    let levelKey = 'none';
    if (total >= 7) levelKey = 'severe';
    else if (total >= 4) levelKey = 'moderate';
    else if (total >= 1) levelKey = 'mild';
    document.getElementById('painad-result-main').innerHTML =
      `<strong>PAINAD:</strong> ${total}/10`;
    document.getElementById('painad-result-interpretation').textContent =
      '0 â€“ skausmo nÄ—ra; 1â€“3 â€“ lengvas; 4â€“6 â€“ vidutinis; 7â€“10 â€“ stiprus skausmas.';
    document.getElementById('painad-result-box').style.display = 'block';
    showRecommendations(levelKey);
  }

  /* ===== PAIC-15 ===== */
  const paicItems = [
    { id:'1',  title:'Suraukta kakta' },
    { id:'2',  title:'Primerktos akys' },
    { id:'3',  title:'Pakelta virÅ¡utinÄ— lÅ«pa' },
    { id:'4',  title:'Praveriama burna' },
    { id:'5',  title:'Ä®tempta veido iÅ¡raiÅ¡ka' },
    { id:'6',  title:'SustabarÄ—jimas' },
    { id:'7',  title:'Apsauginiai judesiai' },
    { id:'8',  title:'PrieÅ¡inimasis prieÅ¾iÅ«rai' },
    { id:'9',  title:'Trinimas / masaÅ¾avimas' },
    { id:'10', title:'Nerimastingumas' },
    { id:'11', title:'Skausmo Å¾odÅ¾iai' },
    { id:'12', title:'Å aukimas' },
    { id:'13', title:'Dejavimas / stenÄ—jimas' },
    { id:'14', title:'MurmÄ—jimas' },
    { id:'15', title:'Skundimasis' }
  ];
  const paicContainer = document.getElementById('paic-items');
  let paicIdx = 1;
  paicItems.forEach(i => {
    const row = document.createElement('div');
    row.className = 'radio-row';
    row.innerHTML = `
      <div>${paicIdx++}</div>
      <div><strong>${i.title}</strong></div>
      <div>StebÄ—kite poÅ¾ymÄ¯ ir Ä¯vertinkite 0â€“3, X â€“ nevertinta</div>
      <div class="radio-group">
        <label><input type="radio" name="paic-${i.id}" value="0">0</label>
        <label><input type="radio" name="paic-${i.id}" value="1">1</label>
        <label><input type="radio" name="paic-${i.id}" value="2">2</label>
        <label><input type="radio" name="paic-${i.id}" value="3">3</label>
        <label><input type="radio" name="paic-${i.id}" value="x">X</label>
      </div>
    `;
    paicContainer.appendChild(row);
  });
  function calculatePaic() {
    let total = 0;
    let notScored = 0;
    paicItems.forEach(i => {
      const sel = document.querySelector(`input[name="paic-${i.id}"]:checked`);
      if (!sel || sel.value === 'x') { notScored++; return; }
      total += Number(sel.value);
    });
    let levelKey = 'none';
    let text = '';
    if (total <= 5) { text = '0â€“5 â€“ maÅ¾ai Ä¯rodymÅ³ apie skausmÄ….'; }
    else if (total <= 15) { text = '6â€“15 â€“ galimas lengvas skausmas.'; levelKey='mild'; }
    else if (total <= 30) { text = '16â€“30 â€“ galimas vidutinio intensyvumo skausmas.'; levelKey='moderate'; }
    else { text = '31â€“45 â€“ galimas stiprus skausmas.'; levelKey='severe'; }
    document.getElementById('paic-result-main').innerHTML =
      `<strong>PAIC suma:</strong> ${total}/45`;
    document.getElementById('paic-result-interpretation').innerHTML =
      text + ` NevertintÅ³/X punktÅ³: ${notScored}.`;
    document.getElementById('paic-result-box').style.display = 'block';
    showRecommendations(levelKey);
  }

  /* ===== ABBEY ===== */
  const abbeyItems = [
    { id:'vocalisation', idx:1, title:'Vokalizacija' },
    { id:'facial',       idx:2, title:'Veido iÅ¡raiÅ¡ka' },
    { id:'body',         idx:3, title:'KÅ«no kalba' },
    { id:'behaviour',    idx:4, title:'Elgesio pokyÄiai' },
    { id:'physio',       idx:5, title:'Fiziologiniai pokyÄiai' },
    { id:'skin',         idx:6, title:'Oda / fiziniai pakitimai' }
  ];
  const abbeyContainer = document.getElementById('abbey-items');
  abbeyItems.forEach(item => {
    const row = document.createElement('div');
    row.className = 'radio-row';
    row.innerHTML = `
      <div>${item.idx}</div>
      <div><strong>${item.title}</strong></div>
      <div>0 â€“ nÄ—ra, 1 â€“ lengvi, 2 â€“ vidutiniai, 3 â€“ ryÅ¡kÅ«s poÅ¾ymiai</div>
      <div class="radio-group">
        <label><input type="radio" name="abbey-${item.id}" value="0">0</label>
        <label><input type="radio" name="abbey-${item.id}" value="1">1</label>
        <label><input type="radio" name="abbey-${item.id}" value="2">2</label>
        <label><input type="radio" name="abbey-${item.id}" value="3">3</label>
      </div>
    `;
    abbeyContainer.appendChild(row);
  });
  function calculateAbbey() {
    let sum = 0;
    abbeyItems.forEach(item => {
      const sel = document.querySelector(`input[name="abbey-${item.id}"]:checked`);
      if (sel) sum += Number(sel.value);
    });
    let levelKey = 'none';
    let text = '';
    if (sum <= 2) { text = '0â€“2 â€“ skausmo nÄ—ra.'; }
    else if (sum <= 7) { text = '3â€“7 â€“ lengvas skausmas.'; levelKey='mild'; }
    else if (sum <= 13) { text = '8â€“13 â€“ vidutinio stiprumo skausmas.'; levelKey='moderate'; }
    else { text = '14+ â€“ stiprus skausmas.'; levelKey='severe'; }
    const typeSel = document.querySelector('input[name="abbey-type"]:checked');
    const pType = typeSel ? typeSel.value : 'nepasirinkta';
    document.getElementById('abbey-result-main').innerHTML =
      `<strong>Abbey suma:</strong> ${sum}/18`;
    document.getElementById('abbey-result-interpretation').innerHTML =
      text + `<br>Skausmo tipas: ${pType}.`;
    document.getElementById('abbey-result-box').style.display = 'block';
    showRecommendations(levelKey);
  }

  /* ===== Rekomendacijos + reset ===== */
  function showRecommendations(level) {
    const main = document.getElementById('recommend-main');
    const extra = document.getElementById('recommend-extra');
    const card = document.getElementById('recommend-card');

    if (level === 'none') {
      main.textContent = 'Skausmo nÄ—ra arba jis minimalus.';
      extra.textContent = 'TÄ™skite stebÄ—senÄ…, pakartotinai Ä¯vertinkite pagal klinikinÄ™ situacijÄ….';
    } else if (level === 'mild') {
      main.textContent = 'Lengvas skausmas.';
      extra.textContent = 'DaÅ¾nai pakanka nefarmakologiniÅ³ priemoniÅ³ ir bazinio analgetiko (pvz., paracetamolis â€“ jei yra gydytojo ord.).';
    } else if (level === 'moderate') {
      main.textContent = 'Vidutinio stiprumo skausmas.';
      extra.textContent = 'DaÅ¾nai reikalingas kombinuotas gydymas (paracetamolis + NVNU ar kitas vaistas pagal gydytojo ord.), vertinkite efektÄ… po 30â€“60 min.';
    } else if (level === 'severe') {
      main.textContent = 'Stiprus skausmas.';
      extra.textContent = 'Reikalingas intensyvus skausmo malÅ¡inimas (galimi parenteraliniai analgetikai, opioidai pagal gydytojo ord.) ir daÅ¾na kontrolÄ—.';
    }
    card.classList.remove('hidden');
  }

  function resetApp() {
    window.location.reload();
  }
</script>
</body>
</html>

